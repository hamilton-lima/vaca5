<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">AudioManager</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.audioTracks</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.game</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.muted</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"audio"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canPlayMp3</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">!=</span><span class="NAME">a.canPlayType</span><span class="PUNC">(</span><span class="STRN">"audio/mpeg"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canPlayOgg</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">!=</span><span class="NAME">a.canPlayType</span><span class="PUNC">(</span><span class="STRN">'audio/ogg; codecs="vorbis"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.loadingStatus</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.audioTracks</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.game.debug.warn</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">+</span><span class="STRN">" audio state : "</span><span class="PUNC">+</span><span class="NAME">d.readyState</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d.readyState</span><span class="PUNC">>=</span><span class="NAME">d.HAVE_CURRENT_DATA</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.register</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Audio</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="NAME">d.loop</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d.addEventListener</span><span class="PUNC">(</span><span class="STRN">"ended"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.currentTime</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">d.autoplay</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.canPlayMp3</span><span class="PUNC">?</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">+</span><span class="STRN">".mp3"</span><span class="PUNC">:</span><span class="NAME">this.canPlayOgg</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">+</span><span class="STRN">".ogg"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">d.src</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">d.load</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.game.debug.warn</span><span class="PUNC">(</span><span class="STRN">"browser not able to play MP3 or OGG"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.play</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a.isFlash</span><span class="PUNC">?</span><span class="NAME">a.playFlash</span><span class="PUNC">(</span><span class="NAME">a.src</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a.play</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.game.debug.warn</span><span class="PUNC">(</span><span class="STRN">"audio :"</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">+</span><span class="STRN">" not registered"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.mute</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.muted</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.audioTracks</span><span class="PUNC">)</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">muted</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.unmute</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.muted</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.audioTracks</span><span class="PUNC">)</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">muted</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.setVolume</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.audioTracks</span><span class="PUNC">)</span><span class="NAME">this.audioTracks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Sprite</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.width</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.height</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">this.src</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">this.image</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.image</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Image</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">,</span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.image.src</span><span class="PUNC">=</span><span class="NAME">this.src</span><span class="PUNC">;</span><span class="NAME">this.update</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.image</span><span class="PUNC">&&</span><span class="NAME">this.image.complete</span><span class="PUNC">&&</span><span class="NAME">a.ctx.drawImage</span><span class="PUNC">(</span><span class="NAME">this.image</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">this.width</span><span class="PUNC">,</span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Label</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.text</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.update</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a.ctx.font</span><span class="PUNC">=</span><span class="STRN">"20px sans-serif"</span><span class="PUNC">;</span><span class="NAME">a.ctx.strokeText</span><span class="PUNC">(</span><span class="NAME">this.text</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Scene</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.width</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.height</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.childs</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.background</span><span class="PUNC">=</span><span class="STRN">"#000000"</span><span class="PUNC">;</span><span class="NAME">this.pointerDownCallbacks</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.pointerUpCallbacks</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.pointerMoveCallbacks</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.update</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearBackGround</span><span class="PUNC">(</span><span class="NAME">a.ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.childs</span><span class="PUNC">)</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.childs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b.update</span><span class="PUNC">&&</span><span class="NAME">b.update</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.start</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.childs</span><span class="PUNC">)</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.childs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b.start</span><span class="PUNC">&&</span><span class="NAME">b.start</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.clearBackGround</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a.fillStyle</span><span class="PUNC">=</span><span class="NAME">this.background</span><span class="PUNC">;</span><span class="NAME">a.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.rect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.width</span><span class="PUNC">,</span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="NAME">a.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.setBackground</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.background</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.add</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.childs.push</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.findById</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">e</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.childs</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.childs</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b.id</span><span class="PUNC">==</span><span class="NAME">a</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SceneEmpty</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.from</span><span class="PUNC">=</span><span class="NAME">Scene</span><span class="PUNC">;</span><span class="NAME">this.from</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.add</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Label</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">30</span><span class="PUNC">,</span><span class="STRN">"_title"</span><span class="PUNC">,</span><span class="STRN">"Empty scene."</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setBackground</span><span class="PUNC">(</span><span class="STRN">"#d0e7f9"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.width</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.height</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">DebugMessage</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.level</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.text</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Debug</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.ERROR</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.WARN</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">this.LOG</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">this.INFO</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">this.limit</span><span class="PUNC">=</span><span class="NUMB">15</span><span class="PUNC">;</span><span class="NAME">this.debugDiv</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.messages</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.level</span><span class="PUNC">=</span><span class="NAME">this.WARN</span><span class="PUNC">;</span><span class="NAME">this.error</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addMessage</span><span class="PUNC">(</span><span class="NAME">this.ERROR</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.warn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addMessage</span><span class="PUNC">(</span><span class="NAME">this.WARN</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.log</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addMessage</span><span class="PUNC">(</span><span class="NAME">this.LOG</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.info</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addMessage</span><span class="PUNC">(</span><span class="NAME">this.INFO</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.addMessage</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.level</span><span class="PUNC">&lt;</span><span class="NAME">a</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.messages.unshift</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DebugMessage</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.levelLabel</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="STRN">"#N/D"</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">"ERROR"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">"WARN"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">"LOG"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">"INFO"</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.show</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.messages.length</span><span class="PUNC">></span><span class="NAME">this.limit</span><span class="PUNC">&&</span><span class="NAME">this.messages.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.debugDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="STRN">"&lt;b>debug&lt;/b>&lt;br>"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.messages</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.messages</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.level</span><span class="PUNC">>=</span><span class="NAME">c.level</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.levelLabel</span><span class="PUNC">(</span><span class="NAME">c.level</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">c.text</span><span class="PUNC">+</span><span class="STRN">"&lt;br>"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.debugDiv.innerHTML</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ShowAllPressedKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.update</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">">"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a.keyPressed</span><span class="PUNC">)</span><span class="NAME">a.keyPressed</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">key</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.ctx.strokeText</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">game</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Game</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.width</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.height</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.debug</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Debug</span><span class="PUNC">(</span><span class="STRN">"debug_div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.audio</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AudioManager</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas</span><span class="PUNC">=</span><span class="NAME">this.ctx</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.currentScene</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SceneEmpty</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">,</span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.supportsTouch</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.lastFPS</span><span class="PUNC">=</span><span class="NAME">this.frameCounter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.showFPS</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.keyPressed</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.keyMapping</span><span class="PUNC">=</span><span class="NAME">_defaultKeyMapping</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.interval</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="NAME">this.update</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.frameCounter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="NAME">this.currentScene.update</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.showFPS</span><span class="PUNC">&&</span><span class="NAME">this.ctx.strokeText</span><span class="PUNC">(</span><span class="NAME">this.lastFPS</span><span class="PUNC">+</span><span class="STRN">"FPS"</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">150</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.start</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.ctx</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="NAME">this.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.currentScene.start</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_update</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_FPSCounter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.updateFPS</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lastFPS</span><span class="PUNC">=</span><span class="NAME">this.frameCounter</span><span class="PUNC">;</span><span class="NAME">this.frameCounter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.isKeyPressed</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.keyMapping</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.keyMapping</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e.name</span><span class="PUNC">==</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">e.keys</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">this.debug.log</span><span class="PUNC">(</span><span class="STRN">"isKeyPressed() target: "</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.keyPressed</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.debug.log</span><span class="PUNC">(</span><span class="STRN">"key: ["</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">+</span><span class="STRN">"] not assigned."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_keydown</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">game.keyPressed</span><span class="PUNC">[</span><span class="NAME">a.keyCode</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_keyup</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">game.keyPressed</span><span class="PUNC">[</span><span class="NAME">a.keyCode</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_update</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">game.update</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">_update</span><span class="PUNC">,</span><span class="NAME">game.interval</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_FPSCounter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">game.updateFPS</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">_FPSCounter</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="NAME">E3</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.keys</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_defaultKeyMapping</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">37</span><span class="PUNC">,</span><span class="NUMB">65</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">39</span><span class="PUNC">,</span><span class="NUMB">68</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="STRN">"up"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">38</span><span class="PUNC">,</span><span class="NUMB">87</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="STRN">"down"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">40</span><span class="PUNC">,</span><span class="NUMB">83</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="STRN">"fire1"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">13</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">KeyMapping</span><span class="PUNC">(</span><span class="STRN">"fire2"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">32</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initGame</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a.width</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">a.height</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">game</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Game</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"keydown"</span><span class="PUNC">,</span><span class="NAME">_keydown</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"keyup"</span><span class="PUNC">,</span><span class="NAME">_keyup</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">game.supportsTouch</span><span class="PUNC">=</span><span class="STRN">"createTouch"</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">;</span><span class="NAME">a.addEventListener</span><span class="PUNC">(</span><span class="STRN">"touchstart"</span><span class="PUNC">,</span><span class="NAME">_mouseDown</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.addEventListener</span><span class="PUNC">(</span><span class="STRN">"touchmove"</span><span class="PUNC">,</span><span class="NAME">_mouseMove</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.addEventListener</span><span class="PUNC">(</span><span class="STRN">"touchend"</span><span class="PUNC">,</span><span class="NAME">_mouseUp</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="NAME">_mouseMove</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="NAME">_mouseUp</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="NAME">_mouseDown</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">game.canvas</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">game</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_mouseDown</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">getTouches</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">game.currentScene.pointerDownCallbacks</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">game.currentScene.pointerDownCallbacks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">(</span><span class="NAME">game</span><span class="PUNC">,</span><span class="NAME">b.x</span><span class="PUNC">,</span><span class="NAME">b.y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_mouseUp</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">getTouches</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.length</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">game.currentScene.pointerUpCallbacks</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">game.currentScene.pointerUpCallbacks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">(</span><span class="NAME">game</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">game.currentScene.pointerUpCallbacks</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">game.currentScene.pointerUpCallbacks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">(</span><span class="NAME">game</span><span class="PUNC">,</span><span class="NAME">b.x</span><span class="PUNC">,</span><span class="NAME">b.y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_mouseMove</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">getTouches</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">game.currentScene.pointerMoveCallbacks</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">game.currentScene.pointerMoveCallbacks</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">d</span><span class="PUNC">(</span><span class="NAME">game</span><span class="PUNC">,</span><span class="NAME">c.x</span><span class="PUNC">,</span><span class="NAME">c.y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.touches</span><span class="PUNC">)</span><span class="NAME">a.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getTouches</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.touches</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;=</span><span class="NAME">a.touches.length</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">getCoords</span><span class="PUNC">(</span><span class="NAME">a.touches</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.push</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">getCoords</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b.push</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getCoords</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.offsetX</span><span class="PUNC">?</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">a.offsetX</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">a.offsetY</span><span class="PUNC">}</span><span class="PUNC">:</span><span class="NAME">a.layerX</span><span class="PUNC">?</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">a.layerX</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">a.layerY</span><span class="PUNC">}</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">a.pageX</span><span class="PUNC">-</span><span class="NAME">game.canvas.offsetLeft</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">a.pageY</span><span class="PUNC">-</span><span class="NAME">game.canvas.offsetTop</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 16</span> </span></pre></body></html>